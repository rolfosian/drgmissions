## **Deep Rock Galactic lua scripts for use with [RE-UE4SS lua API](https://github.com/UE4SS-RE/RE-UE4SS/) to fetch current mission and deep dive data for flask**

- To run DRG headless, use command line arg `-nullrhi` when running the game.
- Tested working with a Windows 10 virtual machine using `-nullrhi` (Requires OpenGL for the UE4SS hook).
- Make sure to [skip intro videos](https://www.pcgamingwiki.com/wiki/Deep_Rock_Galactic#Skip_intro_videos) and also use `-nosplash` command line arg if desired.
- Be sure to disable Steam cloud save synchronization.
- Unzip UE4SS into Deep Rock Galactic\FSD\Binaries\Win64 - this is also the CWD of the scripts run by the UE4SS hook.
* [This script will collect all of the missions generated by DRG up until the date set by the target_date variable](https://github.com/rolfosian/drgmissions/blob/main/mods/long_term_mission_data_collector/Scripts/main.lua). Its corresponding python script for automated `mods.txt` and easy user input for setting the target date is [BulkMissions_Run.py](https://github.com/rolfosian/drgmissions/blob/main/BulkMissions_Run.py). This python script goes in `Deep Rock Galactic\FSD\Binaries\Win64\`. The python interpreter is required to be run with administrator privileges with this script.
- The socket folder in [/mods/long_term_mission_data_collector/Scripts/x64](https://github.com/rolfosian/drgmissions/blob/main/mods/long_term_mission_data_collector/Scripts/x64) is also required in `Deep Rock Galactic\FSD\Binaries\Win64` for this script to work.
- `Deep Rock Galactic\FSD.exe` **AND** `Deep Rock Galactic\FSD\Binaries\Win64\FSD-Win64-Shipping.exe` **AND ALSO** `Steam.exe` **ARE ALL** required to be run with administrator privileges in order for this script to be able to modify the system clock and run without errors!

- [This script](https://github.com/rolfosian/drgmissions/blob/main/mods/GetDailyDeals/Scripts/main.lua) and its [corresponding python script](https://github.com/rolfosian/drgmissions/blob/main/Daily_Trades_Run.py) will fetch all of the daily deals up until the date set by the user input in the python script. **UTC System Clock Timezone is required for this script, as are administrator privileges for the python interpreter.** I tried to do it like the standard missions collector but the game would just hang after the second or third time the clock was changed, so this method restarts the game for every daily deal. Please let me know if you figure out how to build a new DailyDealSettings or something so this isn't required.
- If running the clock changing scripts in a VM, make sure to turn off guest/host timesync, IE: https://www.virtualbox.org/manual/ch09.html#disabletimesync, and pad the timeout/estimated total time variables if desired

- The `.*_Run.py` python scripts will handle toggling the automatic time sync settings on and off.


- [This script will fetch the current DD data and exit the game in short order](https://github.com/rolfosian/drgmissions/blob/main/mods/dds_fetcher/Scripts/main.lua)
- I have set a crontab entry: `59 10 * * 4 /usr/bin/wakeonlan XX:XX:XX:XX:XX:XX` on my home server to automate this. (cron of course requires adjustment if system clock is not UTC). It sends magic packets to wake a junker hardware tertiary machine I built out of old trash every Thursday at 10:59 which in turn runs [this script](https://github.com/rolfosian/drgmissions/blob/main/DDs_Run.py) via [this .bat](https://github.com/rolfosian/drgmissions/blob/main/Run_DDs.bat) and Task Scheduler On event - Log: System, Source: Microsoft-Windows-Power-Troubleshooter, Event ID: 1 (On wake from sleep). Requires automatic logon of administrator account. This of course could also be done with a Virtual Machine instead.

- ~~Consider using [SteamCMD](https://developer.valvesoftware.com/wiki/SteamCMD) for even less overhead and easier automation for updates etc~~ - Doesn't work, the game just says it can't find the Steam service and won't load the start menu.



## **TODO**
- **Public Enemy Number One**: Check and Update Deep Dive scraper weekly to accomodate currently unknown configurations, **contingencies for if Steam misbehaves on wake**
- New flask endpoints, modified index HTML, UE4SS scripts, and multiple virtual machines startup scripts to scrape multiple different sets of mission data concurrently to accomodate different season content toggles
- Figure out a solution to reduce required delay between iterations for accurate data to be collected by the 30 minute incrementer
- Figure out how to manipulate wine(?) system clock with hook on linux
- Clean up and convert Complexity/Length finalization to table lookup
- ~~Contingencies for if the game doesn't terminate gracefully on 'organic' exit~~ Refer to kill process function in [this script](https://github.com/rolfosian/drgmissions/blob/main/DDs_Run.py)
- ~~Contingencies for if the game crashes~~ Refer to timeout logic in `.*_Run.py` scripts.
- ~~Scripts to actually launch the game and upload DD data to flask host weekly~~
- ~~Parallelize png rendering and arraying functions and change png route args to codenames instead of indexing once possible~~ Moved png rendering and arraying to thread pools, but the gains are miniscule because of thread management overhead, the GIL and I/O bound image rendering. It also requires a hard restart of the interpreter so `gunicorn --reload` isn't feasible. Needs processing pools to see gains that are bigger than fractions of a millisecond, but the vps is only 1 vcore so I'm not going to bother debugging the circular multiprocessing import at this stage.

-------------------------------------------------------------------------------------------
***This is a third-party project and it is not affiliated, endorsed, or sponsored by Ghost Ship Games. The use of Deep Rock Galactic's in-game assets in this project is solely for illustrative purposes and does not imply any ownership or association with the game or its developers. All copyrights and trademarks belong to their respective owners. For official information about Deep Rock Galactic, please visit the official Ghost Ship Games website.***
